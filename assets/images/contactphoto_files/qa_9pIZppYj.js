if (self.CavalryLogger) { CavalryLogger.start_js(["aA0oF"]); }

__d("LegacyMapUtils",["clamp","mod"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={MIN_LATITUDE:-85.05112878,MAX_LATITUDE:85.05112878,MIN_LONGITUDE:-180,MAX_LONGITUDE:180,pows:{},MAX_ZOOM:20,BING_MAP_ZOOM_LEVEL_CITY:10,BING_MAP_ZOOM_LEVEL_REGION:6,EARTH_CIRCUMFERENCE_METERS:40074784,scale:function(a,b){b=b-a;g.pows[b]||(g.pows[b]=Math.pow(2,b));return g.pows[b]},mapSize:function(a){return 512*g.scale(1,a)},latLongToXY:function(a,c){var d=b("clamp")(a.latitude,g.MIN_LATITUDE,g.MAX_LATITUDE);a=(a.longitude+180)/360;d=Math.sin(d*Math.PI/180);d=.5-Math.log((1+d)/(1-d))/(4*Math.PI);c=g.mapSize(c);return{x:Math.floor(a*(c-1)+.5),y:Math.floor(d*(c-1)+.5)}},xyToLatLong:function(a,c){c=g.mapSize(c);var d=b("mod")(a.x,c)/c-.5;a=.5-b("clamp")(a.y,0,c-1)/c;c=90-360*Math.atan(Math.exp(-a*2*Math.PI))/Math.PI;a=360*d;return{latitude:c,longitude:a}},getViewForLatLongs:function(a,b,c,d,e,f){__p&&__p();if(!c.length)throw new Error("the proper view for zero point(s) is completely ambiguous");d=d||{t:0,r:0,b:0,l:0};e=e||1;f=f||Infinity;var h=g._getBoundingBox(c),i=d.l+d.r,j=d.t+d.b,k=g.MAX_ZOOM;if(c.length>1){c=g.mapSize(k);while(k>e&&(g._getWidth(h,c)>a-i||h.b-h.t>b-j)||k>f)h=g._rectScale(h,1,2),k--,c=g.mapSize(k)}else while(k!==g.BING_MAP_ZOOM_LEVEL_CITY)k--,h=g._rectScale(h,1,2);c=h.l-d.l;f=h.r+d.r;f<c&&(f+=g.mapSize(k));e={t:h.t-d.t,r:f,b:h.b+d.b,l:c};g.mapSize(k);i={x:(e.l+e.r)/2,y:(e.t+e.b)/2};j=g.xyToLatLong(i,k);return{center:j,width:a,height:b,zoom:k}},_getWidth:function(a,b){return g._calculateRightDistanceAToB(a.l,a.r,b)},_getBoundingBox:function(a){__p&&__p();var b=[],c=g.mapSize(g.MAX_ZOOM);for(var d=0;d<a.length;d++){var e=a[d];b.push(g.latLongToXY(e,g.MAX_ZOOM))}b.sort(function(a,b){return a.x-b.x});e=b.length-1;d=g._calculateRightDistanceAToB(b[e].x,b[0].x,c);a=0;e=e;var f=[b[0].y];for(var h=1;h<b.length;h++){f.push(b[h].y);var i=g._calculateRightDistanceAToB(b[h-1].x,b[h].x,c);i>d&&(d=i,a=h,e=h-1)}i={t:Math.min.apply(null,f),r:b[e].x,b:Math.max.apply(null,f),l:b[a].x};return i},_calculateRightDistanceAToB:function(a,b,c){if(!c)throw new Error("zero or null map width not allowed");return(c+b-a)%c},_rectScale:function(a,b,c){return{t:a.t*b/c,r:a.r*b/c,b:a.b*b/c,l:a.l*b/c}}};e.exports=g}),null);
__d("LegacyMapCoordinate",["LegacyMapUtils","Vector","mod"],(function(a,b,c,d,e,f){__p&&__p();function g(){"use strict";this.absoluteX=null,this.absoluteY=null,this.latitude=null,this.longitude=null}g.fromAbsolute=function(a,c){"use strict";c===undefined&&(c=a.y,a=a.x);var d=new g();d.absoluteX=a;d.absoluteY=c;a=b("LegacyMapUtils").xyToLatLong(new(b("Vector"))(a,c),g.MAX_ZOOM);d.latitude=a.latitude;d.longitude=a.longitude;return d};g.fromLatLong=function(a,c){"use strict";c===undefined&&(c=a.longitude,a=a.latitude);var d=new g();d.latitude=a;d.longitude=c;a=b("LegacyMapUtils").latLongToXY({latitude:a,longitude:c},g.MAX_ZOOM);d.absoluteX=a.x;d.absoluteY=a.y;return d};g.fromMap=function(a,c,d){"use strict";d=b("LegacyMapUtils").scale(d,g.MAX_ZOOM);return g.fromAbsolute(a*d,c*d)};g.prototype.getLatitude=function(){"use strict";return this.latitude};g.prototype.getLongitude=function(){"use strict";return this.longitude};g.prototype.getAbsoluteX=function(){"use strict";return this.absoluteX};g.prototype.getAbsoluteY=function(){"use strict";return this.absoluteY};g.prototype.getAbsoluteXY=function(){"use strict";return new(b("Vector"))(this.absoluteX,this.absoluteY)};g.prototype.getMapX=function(a){"use strict";return this.getMapXY(a).x};g.prototype.getMapY=function(a){"use strict";return this.getMapXY(a).y};g.prototype.getMapXY=function(a){"use strict";a=b("LegacyMapUtils").scale(g.MAX_ZOOM,a);var c=this.absoluteX*a;a=this.absoluteY*a;return new(b("Vector"))(c,a)};g.prototype.add=function(a,b){"use strict";var c=this.getMapXY(a);return g.fromMap(c.x+b.x,c.y+b.y,a)};g.prototype.calculateDistanceSq=function(a,b){"use strict";var c=this.calculateDistanceX(a,b);a=this.calculateDistanceY(a,b);return c*c+a*a};g.prototype.calculateDistanceX=function(a,c){"use strict";var d=b("LegacyMapUtils").mapSize(a);c=b("mod")(c.getMapX(a)-this.getMapX(a),d);return Math.min(c,d-c)};g.prototype.calculateDistanceY=function(a,b){"use strict";return Math.abs(b.getMapY(a)-this.getMapY(a))};Object.assign(g,{MAX_ZOOM:18,MIN_ZOOM:1});e.exports=g}),null);
__d("MapAggregation",["removeFromArray"],(function(a,b,c,d,e,f){__p&&__p();function a(){this.combine=null,this.iterations=0,this.candidates=null,this.loners=null}Object.assign(a.prototype,{aggregate:function(a,c,d){__p&&__p();this.overlap=d?d:this._overlap;this.candidates=a;this.combine=c;this.loners=[];while(this.candidates.length>0){d=this.candidates[this.candidates.length-1];do{a=d.center;this._group(d,Number.MAX_VALUE);c=a!==d.center}while(!this._isDeleted(d)&&c);this._isDeleted(d)||(b("removeFromArray")(this.candidates,d),this.loners.push(d))}return this.loners},_isDeleted:function(a){return a.center===null},_delete:function(a){b("removeFromArray")(this.candidates,a),b("removeFromArray")(this.loners,a),a.center=null},_group:function(a,b){__p&&__p();while(!0){this.iterations++;if(this.iterations>=1e4){this.iterations%1e4===0&&0&&!1;return}var c=this._nearest(a),d=c.nearest;c=c.distanceSquared;if(!d||c>b||!this.overlap(a,d))return;var e=d.center,f=a.center;this._group(d,c-1);if(this._isDeleted(a))return;c=d.center!==e;e=a.center!==f;if(!c&&!e){this.combine(a,d);this._delete(d);return}}},_nearest:function(a){__p&&__p();var b,c,d,e=null,f=Number.MAX_VALUE;for(b=0;b<this.candidates.length;b++){d=this.candidates[b];if(d===a)continue;c=this._distanceSquared(a,d);c<f&&(e=d,f=c)}for(b=0;b<this.loners.length;b++){d=this.loners[b];if(d===a)continue;c=this._distanceSquared(a,d);c<f&&(e=d,f=c)}return{nearest:e,distanceSquared:f}},_overlap:function(a,b){var c=a.radius+b.radius;return this._distanceSquared(a,b)<c*c},_distanceSquared:function(a,b){var c=a.center.x-b.center.x;a=a.center.y-b.center.y;return c*c+a*a}});e.exports=a}),null);
__d("MapRects",["Rect","Vector","clamp"],(function(a,b,c,d,e,f){__p&&__p();function g(){}Object.assign(g,{containsPoint:function(a,b,c){c===void 0&&(c=0);c===undefined&&(c=0);return a.t<=b.y+c&&a.r>=b.x-c&&a.b>=b.y-c&&a.l<=b.x+c},pad:function(a,b){return g.padXY(a,b,b)},padX:function(a,b){return g.padXY(a,b,0)},padY:function(a,b){return g.padXY(a,0,b)},padXY:function(a,c,d){return new(b("Rect"))(a.t-d,a.r+c,a.b+d,a.l-c,a.domain)},collides:function(a,b){return a.t<b.b&&a.b>b.t&&a.l<b.r&&a.r>b.l},boundPoint:function(a,c){var d=new(b("Vector"))(0,0);d.x=b("clamp")(c.x,a.l,a.r);d.y=b("clamp")(c.y,a.t,a.b);return d},boundingBox:function(a,c){return new(b("Rect"))(Math.min(a.t,c.t),Math.max(a.r,c.r),Math.max(a.b,c.b),Math.min(a.l,c.l))},scale:function(a,c,d){return new(b("Rect"))(a.t*c/d,a.r*c/d,a.b*c/d,a.l*c/d)}});e.exports=g}),null);